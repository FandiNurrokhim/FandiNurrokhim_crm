import{r as $,j as e,v as Y,m as Z,q as W,Y as J}from"./app-DdujxetC.js";import{r as Q}from"./index-Rb7ez85R.js";import{A as ee}from"./AuthenticatedLayout-mM-Jrmzm.js";import{P as te}from"./PageHeader-Bv8DjmKd.js";import{S as _}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{u as k}from"./useTranslation-8BayAZb4.js";import{I as L}from"./InputLabel-BzWnVHML.js";import{T as S}from"./TextInput-BmMh6PqU.js";import{I as P}from"./InputError-Cg3yzoP4.js";import{H as se}from"./HomeCarousel-DaNJ6o_C.js";import"./index-BnYHGNjJ.js";import"./floating-ui.dom-AzuEyJcm.js";import"./ApplicationLogo-DDW-aaz4.js";import"./Logo-Dq8nsJV3.js";import"./LanguageDropdown-CZVTQBmi.js";import"./ResponsiveNavLink-DDPMZpeH.js";import"./Avatar-D3FqKlbf.js";import"./imageHelper-19DfnHcd.js";const U=({label:a,name:i,value:u,error:f,onChange:o})=>{const{t:v}=k(),p=$.useRef(),j=h=>{const c=h.target.files[0];if(c){const x=new FileReader;x.onload=b=>{o&&o(c,b.target.result)},x.readAsDataURL(c)}else o&&o(null,"")},g=()=>{p.current&&(p.current.value=""),o&&o(null,"")};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-semibold",children:a}),u?e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md p-2 text-xs text-green-600",children:[e.jsx("span",{className:"inline-flex items-center justify-center mr-2",children:e.jsx("img",{src:"/assets/icons/upload.svg",alt:"Upload Icon",className:"h-6 w-6"})}),e.jsx("span",{className:"flex-1",children:v("global.fileUploaded")}),e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 ml-2",title:"Hapus file",onClick:g,children:e.jsx("svg",{className:"h-5 w-5 inline",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("label",{className:"relative flex items-center w-full border border-gray-200 rounded-md bg-gray-50 px-3 py-2 text-xs text-gray-600 cursor-pointer",children:[e.jsx("span",{className:"inline-flex items-center justify-center mr-2",children:e.jsx("img",{src:"/assets/icons/upload.svg",alt:"Upload Icon",className:"h-6 w-6"})}),e.jsx("div",{className:"font-medium text-gray-500 bg-gray-300 rounded-md px-3 py-1 hover:bg-blue-600 hover:text-white cursor-pointer",children:"Pilih File"}),e.jsx("input",{ref:p,type:"file",accept:"image/*",name:i,onChange:j,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsx("span",{className:"ml-4 text-xs text-gray-400 select-none pointer-events-none",children:v("global.noFileSelected")})]}),u&&e.jsx("img",{src:u,alt:`Preview ${a}`,className:"mt-2 rounded shadow max-h-32"}),f&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:f})]})},ae=({label:a,onFileChange:i,imagePreview:u})=>{const f=$.useRef(null),[o,v]=$.useState(u||null);$.useEffect(()=>{v(u||null)},[u]);const p=()=>{f.current.click()},j=g=>{const h=g.target.files[0];if(!h)return;if(h.size>2*1024*1024){alert("Ukuran file tidak boleh lebih dari 2MB."),g.target.value="";return}const c=new FileReader;c.onload=x=>{v(x.target.result),i&&i(h,x.target.result)},c.readAsDataURL(h)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:`w-full h-56 rounded-xl flex items-center justify-center bg-gray-600 text-white font-bold text-center relative overflow-hidden ${o?"bg-cover bg-center":""}`,style:{backgroundImage:o?`url(${o})`:"none"},onClick:p,children:[!o&&e.jsx("span",{className:"z-10 pointer-events-none",children:a}),e.jsx("input",{type:"file",accept:"image/*",ref:f,onChange:j,className:"hidden"})]}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("button",{type:"button",onClick:p,className:"px-4 py-1 bg-gray-300 rounded-md font-semibold hover:bg-gray-400",children:o?"Ganti Gambar":"Choose File"})})]})},re=({label:a,name:i,onChange:u,header:f="",text:o="",link:v="",imagePreview:p="",onFieldChange:j,errors:g={}})=>{const{t:h}=k();return e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx("label",{className:"block font-semibold mb-1",children:a}),e.jsx(ae,{label:a,imagePreview:p,onFileChange:(c,x)=>u({name:i,file:c,preview:x})}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:`header_${i}`,value:"Header"}),e.jsx(S,{id:`header_${i}`,name:`header_${i}`,value:f,onChange:j,className:"mt-1 block w-full",autoComplete:`header_${i}`,placeholder:h("setting.bannerEventHeaderPlaceholder"),required:!0}),e.jsx(P,{message:g[`header_${i}`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:`text_${i}`,value:"Text"}),e.jsx(S,{id:`text_${i}`,name:`text_${i}`,value:o,onChange:j,className:"mt-1 block w-full",autoComplete:`text_${i}`,placeholder:h("setting.bannerEventTextPlaceholder"),required:!0}),e.jsx(P,{message:g[`text_${i}`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:`link_${i}`,value:"Link"}),e.jsx(S,{id:`link_${i}`,name:`link_${i}`,value:v,onChange:j,className:"mt-1 block w-full",autoComplete:`link_${i}`,pattern:"https://.*",title:"Link harus diawali dengan https://",placeholder:"https://example.com",required:!0}),e.jsx(P,{message:g[`link_${i}`],className:"mt-2"})]})]})},C=["event1","event2","event3","event4"],M=["Our Choice","Recommendation"],y=["Makanan","Minuman","Kudapan"],O=5,ie=O*1024*1024,ne=({banners:a})=>{const{t:i}=k(),u=t=>{const s=a==null?void 0:a.find(r=>r.title===t);if(s!=null&&s.image){const r=s.image.split("/"),n=encodeURIComponent(r.pop());return`/storage/${r.join("/")}/${n}`}return""},f=()=>y.map(t=>({label:t,image:u(`banner_${t.toLowerCase()}`)})),o=()=>M.map(t=>{const s=t.toLowerCase().replace(/\s+/g,"_");return{label:t,key:s,image:u(`banner_${s}`)}}),v=()=>{const t={};return C.forEach(s=>{const r=(a==null?void 0:a.find(n=>n.title===s))||{};t[s]={file:null,header:r.header||"",text:r.text||"",link:r.link||"",imagePreview:u(s)}}),t},[p,j]=$.useState(f),[g,h]=$.useState(o),[c,x]=$.useState(v),{data:b,setData:E,processing:T,errors:B,reset:A}=Y({...Object.fromEntries(y.map(t=>[`banner_${t.toLowerCase()}`,null])),...Object.fromEntries(M.map(t=>{var r;const s=t.toLowerCase().replace(/\s+/g,"_");return[s,((r=a==null?void 0:a.find(n=>n.title===`banner_${s}`))==null?void 0:r.image)||null]})),...Object.fromEntries(C.flatMap(t=>{var s,r,n;return[[`header_${t}`,((s=a==null?void 0:a.find(d=>d.title===t))==null?void 0:s.header)||""],[`text_${t}`,((r=a==null?void 0:a.find(d=>d.title===t))==null?void 0:r.text)||""],[`link_${t}`,((n=a==null?void 0:a.find(d=>d.title===t))==null?void 0:n.link)||""]]})),...Object.fromEntries(C.map(t=>[t,null]))});$.useEffect(()=>{j(f()),h(o()),x(v())},[a]);const z=(t,s,r)=>{const n=`banner_${t.toLowerCase()}`;j(d=>d.map(m=>m.label===t?{...m,image:r}:m)),E(n,s)},H=t=>t&&t.size<=ie,q=(t,s,r)=>{const n=t.toLowerCase().replace(/\s+/g,"_");h(d=>d.map(m=>m.key===n?{...m,image:r}:m)),E(n,s)},G=({name:t,file:s,preview:r})=>{x(n=>({...n,[t]:{...n[t],file:s,imagePreview:r}})),E(t,s||null)},V=t=>{const{name:s,value:r}=t.target,[n,d]=s.split("_");x(m=>({...m,[d]:{...m[d],[n]:r}})),E(s,r)},K=async t=>{t.preventDefault();const s=y.every(l=>{var w;return(w=p.find(N=>N.label===l))==null?void 0:w.image}),r=["event1","event2"].every(l=>c[l].file||c[l].imagePreview);if(!s||!r){_.fire({icon:"info",title:"Lengkapi Gambar",text:"Minimal semua banner utama dan event 1 & 2 harus diisi sebelum submit."});return}if([...y.map(l=>b[`banner_${l.toLowerCase()}`]),...M.map(l=>{const w=l.toLowerCase().replace(/\s+/g,"_");return b[w]}),...C.map(l=>b[l])].filter(Boolean).filter(l=>l&&!H(l)).length>0){_.fire({icon:"error",title:"File Terlalu Besar",text:`Ukuran file tidak boleh melebihi ${O}MB.`});return}const m=new FormData,I=new FormData,D=Object.keys(b),X=Math.ceil(D.length/2);D.forEach((l,w)=>{const N=b[l],F=w<X?m:I;N!==null&&(N instanceof File||typeof N=="string")&&F.append(l,N)});const R=async(l,w)=>new Promise((N,F)=>{_.fire({title:`Mengupload bagian ${w}...`,html:"Mohon tunggu sebentar.",allowOutsideClick:!1,didOpen:()=>{_.showLoading()}}),Z.post("/admin/setting",l,{forceFormData:!0,onSuccess:()=>{_.close(),N()},onError:()=>{_.fire({icon:"error",title:`Gagal upload bagian ${w}`}),F()}})});try{await R(m,1),await R(I,2),A(),_.fire({icon:"success",title:"Semua data berhasil diunggah!"})}catch{}};return console.log("Banner Debug:",{sliderPreview:g,data:b,errors:B}),e.jsxs("form",{className:"p-4 space-y-6",onSubmit:K,children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:y.map((t,s)=>e.jsx(U,{label:`Banner ${t}`,name:`banner_${t.toLowerCase()}`,value:p[s].image,error:B[`banner_${t.toLowerCase()}`],onChange:(r,n)=>z(t,r,n)},t))}),e.jsx("div",{className:"container",children:e.jsx(se,{isPreview:!0,previewBanners:p})})]}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:g.map(({label:t,key:s,image:r},n)=>e.jsx(U,{label:`Banner ${t}`,name:s,value:r,error:B[s],onChange:(d,m)=>q(t,d,m)},s))})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:C.map((t,s)=>e.jsx(re,{label:`Event ${s+1}`,name:t,onChange:G,header:c[t].header,text:c[t].text,link:c[t].link,imagePreview:c[t].imagePreview,onFieldChange:V},t))}),e.jsx("button",{type:"submit",className:"bg-[#D9B36A] text-[#0E1C2D] hover:bg-[#caa45f] rounded-md w-full px-4 py-1.5 text-lg font-semibold transition",disabled:T,children:i("global.save")})]})},Ce=()=>{const a=W().props.banners||[],{t:i}=k();return e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(te,{title:i("setting.pageTitle"),subtitle:i("setting.pageSubtitle")}),e.jsxs(Q.Breadcrumbs,{className:"bg-slate-800 p-2 rounded-md text-white mb-4",children:[e.jsx(J,{href:"dashboard",className:"opacity-60 hover:opacity-100",children:"Dashboard"}),e.jsx("span",{children:i("setting.pageTitle")})]}),e.jsx(ne,{banners:a})]})})};export{Ce as default};
